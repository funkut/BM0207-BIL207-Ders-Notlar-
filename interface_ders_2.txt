// Gerekli kÃ¼tÃ¼phaneler
using System;
using System.Threading;
using System.Collections.Generic; // List<T> iÃ§in
using System.Linq;                // .ToList() iÃ§in

namespace BildirimSistemiApp
{
    // -----------------------------------------------------------------
    // 1. ADIM: BÄ°LDÄ°RÄ°M ARAYÃœZÃœ (INTERFACE) - DEÄÄ°ÅMEDÄ°
    // -----------------------------------------------------------------
    public interface IBildirilebilir
    {
        string Ad { get; }
        string BildirimTonu { get; set; }
        int BildirimSesiSeviyesi { get; set; }
        bool BildirimlerAcik { get; set; }
        void AyarlariGoster();
        void BildirimGonder(string mesaj);
    }

    // -----------------------------------------------------------------
    // 2. ADIM: SOMUT SINIF - DEÄÄ°ÅMEDÄ°
    // -----------------------------------------------------------------
    public class Uygulama : IBildirilebilir
    {
        public string Ad { get; private set; }
        public string BildirimTonu { get; set; }
        public int BildirimSesiSeviyesi { get; set; }
        public bool BildirimlerAcik { get; set; }

        public Uygulama(string ad, string varsayilanTon)
        {
            Ad = ad;
            BildirimTonu = varsayilanTon;
            BildirimSesiSeviyesi = 80;
            BildirimlerAcik = true;
        }

        public void AyarlariGoster()
        {
            string durum = BildirimlerAcik ? "AÃ‡IK" : "KAPALI";
            ConsoleColor durumRengi = BildirimlerAcik ? ConsoleColor.Green : ConsoleColor.Red;

            Console.Write($"  > {Ad.PadRight(10)} | Durum: ");
            Program.PrintColor(durum.PadRight(8), durumRengi);
            Console.Write($"| Ton: {BildirimTonu.PadRight(12)} | Ses: {BildirimSesiSeviyesi}%\n");
        }

        public void BildirimGonder(string mesaj)
        {
            if (BildirimlerAcik)
            {
                Program.PrintSuccess($"\nğŸ”” [{Ad}] YENÄ° BÄ°LDÄ°RÄ°M: '{mesaj}'");
                Console.WriteLine($"   (Ses: {BildirimSesiSeviyesi}%, Ton: {BildirimTonu})");
            }
            else
            {
                Program.PrintWarning($"\nğŸ”‡ [{Ad}] Sessize AlÄ±ndÄ±: '{mesaj}'");
            }
        }
    }

    // -----------------------------------------------------------------
    // 3. ADIM: PROGRAM AKIÅI (ANA METOT)
    // -----------------------------------------------------------------
    public class Program
    {
        private static Random random = new Random();

        // --- YENÄ°: Sabit Bildirim Tonu Listesi ---
        private static List<string> mevcutTonlar = new List<string>
        {
            "Tri-tone",
            "Swoosh",
            "Chime",
            "Pop-up",
            "Knock",
            "Tweet",
            "Discord",
            "Zil Sesi (VarsayÄ±lan)"
        };

        public static void Main(string[] args)
        {
            PrintTitle("Bildirim YÃ¶neticisi BaÅŸlatÄ±lÄ±yor...");
            List<IBildirilebilir> acikUygulamalar = new List<IBildirilebilir>();
            var uygulamaHavuzu = new Dictionary<string, string>
            {
                { "Instagram", "Pop-up" },
                { "WhatsApp", "Tri-tone" },
                { "Gmail", "Swoosh" },
                { "Twitter", "Tweet" },
                { "Discord", "Discord" },
                { "Slack", "Knock" },
                { "YouTube", "Chime" }
            };

            // Havuzdan 4 tane benzersiz uygulama seÃ§
            List<string> havuzAnahtarlari = uygulamaHavuzu.Keys.ToList();
            for (int i = 0; i < 4; i++)
            {
                if (havuzAnahtarlari.Count == 0) break;
                int rastgeleIndex = random.Next(0, havuzAnahtarlari.Count);
                string secilenAd = havuzAnahtarlari[rastgeleIndex];
                // SeÃ§ilen tonun, bizim listemizde olduÄŸundan emin olalÄ±m
                string varsayilanTon = uygulamaHavuzu[secilenAd];
                if (!mevcutTonlar.Contains(varsayilanTon))
                {
                    varsayilanTon = mevcutTonlar[0]; // Listede yoksa ilkini ata
                }

                acikUygulamalar.Add(new Uygulama(secilenAd, varsayilanTon));
                havuzAnahtarlari.RemoveAt(rastgeleIndex);
            }

            PrintSuccess("4 rastgele uygulama iÃ§in bildirim ayarlarÄ± yÃ¼klendi.\n");
            Thread.Sleep(1000);

            // --- 2. ANA YÃ–NETÄ°M DÃ–NGÃœSÃœ ---
            while (true)
            {
                Console.Clear();

                // --- GÃœNCELLENDÄ°: Ana uygulama listesi artÄ±k kendi metodunda ---
                AnaListeyiGoster(acikUygulamalar);

                // Ana MenÃ¼
                PrintTitle("ANA MENÃœ");
                Console.WriteLine("DÃ¼zenlemek istediÄŸiniz uygulamayÄ± seÃ§in (1-4):");
                Console.WriteLine("5: Rastgele bir test bildirimi gÃ¶nder");
                Console.WriteLine("6: Ã‡Ä±kÄ±ÅŸ");
                Console.Write("SeÃ§iminiz: ");

                string secim = Console.ReadLine();

                switch (secim)
                {
                    case "1":
                        // --- GÃœNCELLENDÄ°: ArtÄ±k 'acikUygulamalar' listesini de gÃ¶nderiyoruz ---
                        UygulamayiDuzenle(acikUygulamalar[0], acikUygulamalar);
                        break;
                    case "2":
                        UygulamayiDuzenle(acikUygulamalar[1], acikUygulamalar);
                        break;
                    case "3":
                        UygulamayiDuzenle(acikUygulamalar[2], acikUygulamalar);
                        break;
                    case "4":
                        UygulamayiDuzenle(acikUygulamalar[3], acikUygulamalar);
                        break;
                    case "5":
                        int testIndex = random.Next(0, acikUygulamalar.Count);
                        acikUygulamalar[testIndex].BildirimGonder("Bu bir test bildirimidir!");
                        Console.WriteLine("\nDevam etmek iÃ§in bir tuÅŸa basÄ±n...");
                        Console.ReadKey();
                        break;
                    case "6":
                        PrintWarning("Programdan Ã§Ä±kÄ±lÄ±yor...");
                        return; // Main metodu sonlandÄ±r
                    default:
                        PrintError("GeÃ§ersiz seÃ§im. LÃ¼tfen 1-6 arasÄ± bir sayÄ± girin.");
                        Thread.Sleep(1000);
                        break;
                }
            }
        }

        // --- YENÄ° METOT: Ana Uygulama Listesini YazdÄ±ran YardÄ±mcÄ± Metot ---
        /// <summary>
        /// 4 ana uygulamanÄ±n listesini ekranÄ±n Ã¼stÃ¼ne Ã§izer.
        /// </summary>
        public static void AnaListeyiGoster(List<IBildirilebilir> acikUygulamalar)
        {
            PrintTitle("BÄ°LDÄ°RÄ°M YÃ–NETÄ°CÄ°SÄ° - UYGULAMALARINIZ");
            Console.WriteLine("AÅŸaÄŸÄ±daki uygulamalarÄ±n mevcut ayarlarÄ±:\n");

            for (int i = 0; i < acikUygulamalar.Count; i++)
            {
                Console.Write($"{i + 1}.");
                acikUygulamalar[i].AyarlariGoster();
            }
            // 46 karakterlik bir ayÄ±rÄ±cÄ±
            Console.WriteLine("\n" + new string('=', 46));
        }


        // --- GÃœNCELLENDÄ°: Uygulama DÃ¼zenleme Metodu ---
        /// <summary>
        /// Bir uygulamanÄ±n ayarlarÄ±nÄ± deÄŸiÅŸtirmek iÃ§in alt menÃ¼yÃ¼ aÃ§an metot.
        /// </summary>
        /// <param name="uygulama">AyarlarÄ± deÄŸiÅŸtirilecek olan 'IBildirilebilir' nesnesi</param>
        /// <param name="tumUygulamalar">Ãœst menÃ¼yÃ¼ tekrar Ã§izebilmek iÃ§in 4 uygulamanÄ±n tam listesi</param>
        public static void UygulamayiDuzenle(IBildirilebilir uygulama, List<IBildirilebilir> tumUygulamalar)
        {
            while (true)
            {
                Console.Clear();

                // --- YENÄ°: EN ÃœSTE ANA LÄ°STEYÄ° Ã‡Ä°Z ---
                AnaListeyiGoster(tumUygulamalar);

                // --- ALT MENÃœ ---
                PrintTitle($"[{uygulama.Ad}] AYARLARI DÃœZENLE");
                Console.WriteLine("Mevcut Ayar:");
                Console.Write("   -> "); // SeÃ§ili olduÄŸunu belirtmek iÃ§in girinti
                uygulama.AyarlariGoster(); // Sadece mevcut uygulamanÄ±n ayarÄ±nÄ± tekrar gÃ¶ster

                Console.WriteLine("\nNe yapmak istiyorsunuz?");
                Console.WriteLine("1: Bildirim Tonunu DeÄŸiÅŸtir");
                Console.WriteLine("2: Bildirim Ses Seviyesini DeÄŸiÅŸtir");
                Console.WriteLine("3: Bildirimleri AÃ§ / Kapat");
                Console.WriteLine("4: Ana MenÃ¼ye Geri DÃ¶n");
                Console.Write("SeÃ§iminiz: ");

                string secim = Console.ReadLine();
                switch (secim)
                {
                    // --- GÃœNCELLENDÄ°: BÄ°LDÄ°RÄ°M TONU SEÃ‡Ä°MÄ° ---
                    case "1":
                        PrintWarning("\n--- Ton DeÄŸiÅŸtir ---");
                        Console.WriteLine("LÃ¼tfen listeden bir ton seÃ§in:");

                        // Sabit 'mevcutTonlar' listesini yazdÄ±r
                        for (int i = 0; i < mevcutTonlar.Count; i++)
                        {
                            Console.WriteLine($"  {i + 1}: {mevcutTonlar[i]}");
                        }

                        // KullanÄ±cÄ±dan ton seÃ§imi iÃ§in doÄŸrulama dÃ¶ngÃ¼sÃ¼
                        while (true)
                        {
                            Console.Write($"\nSeÃ§iminiz (1-{mevcutTonlar.Count}): ");
                            if (int.TryParse(Console.ReadLine(), out int tonSecimi) && tonSecimi >= 1 && tonSecimi <= mevcutTonlar.Count)
                            {
                                // SeÃ§imi ata (Index 0'dan baÅŸladÄ±ÄŸÄ± iÃ§in -1)
                                uygulama.BildirimTonu = mevcutTonlar[tonSecimi - 1];
                                PrintSuccess("Bildirim tonu gÃ¼ncellendi!");
                                Thread.Sleep(750);
                                break; // DoÄŸrulama dÃ¶ngÃ¼sÃ¼nden Ã§Ä±k
                            }
                            else
                            {
                                PrintError("GeÃ§ersiz seÃ§im.");
                            }
                        }
                        break; // 'case "1"' den Ã§Ä±k

                    case "2":
                        PrintWarning("\n--- Ses Seviyesi DeÄŸiÅŸtir ---");
                        while (true)
                        {
                            Console.Write("Yeni ses seviyesi girin (0-100 arasÄ±): ");
                            if (int.TryParse(Console.ReadLine(), out int yeniSes) && yeniSes >= 0 && yeniSes <= 100)
                            {
                                uygulama.BildirimSesiSeviyesi = yeniSes;
                                PrintSuccess("Ses seviyesi gÃ¼ncellendi!");
                                Thread.Sleep(750);
                                break;
                            }
                            else
                            {
                                PrintError("GeÃ§ersiz giriÅŸ. LÃ¼tfen 0 ile 100 arasÄ±nda bir sayÄ± girin.");
                            }
                        }
                        break;

                    case "3":
                        uygulama.BildirimlerAcik = !uygulama.BildirimlerAcik;
                        string durumMesaji = uygulama.BildirimlerAcik ? "Bildirimler AÃ‡ILDI" : "Bildirimler KAPATILDI";
                        PrintSuccess(durumMesaji);
                        Thread.Sleep(750);
                        break;

                    case "4":
                        return; // Bu metottan Ã§Ä±k, ana dÃ¶ngÃ¼ye geri dÃ¶n

                    default:
                        PrintError("GeÃ§ersiz seÃ§im. LÃ¼tfen 1-4 arasÄ± bir sayÄ± girin.");
                        Thread.Sleep(1000);
                        break;
                }
            }
        }


        // --- Renkli YazdÄ±rma iÃ§in YardÄ±mcÄ± Metotlar (DEÄÄ°ÅMEDÄ°) ---
        public static void PrintError(string message)
        {
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine(message);
            Console.ResetColor();
        }
        public static void PrintSuccess(string message)
        {
            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine(message);
            Console.ResetColor();
        }
        public static void PrintTitle(string message)
        {
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.WriteLine(message);
            Console.ResetColor();
        }
        public static void PrintWarning(string message)
        {
            Console.ForegroundColor = ConsoleColor.Yellow;
            Console.WriteLine(message);
            Console.ResetColor();
        }
        public static void PrintColor(string message, ConsoleColor color)
        {
            Console.ForegroundColor = color;
            Console.Write(message);
            Console.ResetColor();
        }
    }
}